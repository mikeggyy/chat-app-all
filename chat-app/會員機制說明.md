# 會員機制完整說明

本文件詳細記錄了系統中四種用戶類型的功能限制與權益差異。

## 用戶類型概覽

| 用戶類型             | 說明                                | 月費    |
| -------------------- | ----------------------------------- | ------- |
| **遊客**             | 測試用戶（test-user），用於開發測試 | 免費    |
| **一般用戶（Free）** | 免費註冊用戶                        | 免費    |
| **VIP**              | 付費會員                            | 399 TWD |
| **VVIP**             | 高級付費會員                        | 999 TWD |

---

## 一、對話功能限制

### 每個角色的對話次數

| 用戶類型     | 基礎額度         | 廣告解鎖           | 重置週期         |
| ------------ | ---------------- | ------------------ | ---------------- |
| **遊客**     | 可配置（測試用） | 可配置             | -                |
| **免費用戶** | 10 次/角色       | ✅ 每次廣告 +5 次  | 每個角色獨立計算 |
| **VIP**      | 20 次/角色       | ✅ 每次廣告 +10 次 | 每個角色獨立計算 |
| **VVIP**     | 50 次/角色       | ✅ 每次廣告 +20 次 | 每個角色獨立計算 |

### 廣告解鎖機制

| 用戶類型     | 每次廣告解鎖 | 每日廣告上限 | 廣告冷卻時間 |
| ------------ | ------------ | ------------ | ------------ |
| **免費用戶** | 5 次對話     | 10 次        | 5 分鐘       |
| **VIP**      | 10 次對話    | 10 次        | 5 分鐘       |
| **VVIP**     | 20 次對話    | 10 次        | 5 分鐘       |

- **限制範圍**: 每個角色獨立計算廣告次數

---

## 二、語音功能限制

### 每個角色的語音播放次數

| 用戶類型     | 基礎額度         | 廣告解鎖          | 重置週期         |
| ------------ | ---------------- | ----------------- | ---------------- |
| **遊客**     | 可配置（測試用） | 可配置            | -                |
| **免費用戶** | 10 次/角色       | ✅ 每次廣告 +5 次 | 每個角色獨立計算 |
| **VIP**      | 無限制 (-1)      | ❌ 不需要         | -                |
| **VVIP**     | 無限制 (-1)      | ❌ 不需要         | -                |

### 廣告解鎖機制（僅免費用戶）

- **每次廣告解鎖**: 5 次語音播放
- **每日廣告上限**: 10 次
- **廣告冷卻時間**: 5 分鐘
- **限制範圍**: 每個角色獨立計算

---

## 三、AI 拍照功能限制

### 拍照額度與重置機制

| 用戶類型     | 基礎額度 | 重置週期       | 可購買拍照卡    |
| ------------ | -------- | -------------- | --------------- |
| **遊客**     | 可配置   | 終生（不重置） | ❌              |
| **免費用戶** | 3 張/週  | 每週一重置     | ✅ 可用金幣購買 |
| **VIP**      | 3 張/週  | 每週一重置     | ✅ 可用金幣購買 |
| **VVIP**     | 3 張/週  | 每週一重置     | ✅ 可用金幣購買 |

### 開通時贈送拍照卡（一次性）

| 用戶類型     | 贈送數量 |
| ------------ | -------- |
| **免費用戶** | 0 張     |
| **VIP**      | 20 張    |
| **VVIP**     | 60 張    |

### 拍照功能價格（金幣）

- **所有會員等級統一價格**: 50 金幣/張

---

## 四、角色創建功能限制

### 每月創建額度

| 用戶類型     | 基礎額度 | 開通贈送創建卡      | 重置週期      |
| ------------ | -------- | ------------------- | ------------- |
| **遊客**     | 可配置   | 0 張                | -             |
| **免費用戶** | 3 個/月  | 0 張                | 每月 1 日重置 |
| **VIP**      | 3 個/月  | **10 張**（一次性） | 每月 1 日重置 |
| **VVIP**     | 3 個/月  | **30 張**（一次性） | 每月 1 日重置 |

> **說明**:
>
> - 所有會員等級的基礎額度都是每月 3 個角色
> - VIP 開通時額外贈送 10 張創建角色卡（永久有效）
> - VVIP 開通時額外贈送 30 張創建角色卡（永久有效）
> - 創建角色卡優先於每月基礎額度使用

---

## 五、AI 模型與對話品質

### AI 模型配置

| 用戶類型     | AI 模型       | 回覆長度上限 | 記憶容量      |
| ------------ | ------------- | ------------ | ------------- |
| **遊客**     | 可配置        | 可配置       | 可配置        |
| **免費用戶** | gpt-4o-mini   | 30 tokens    | 1,000 tokens  |
| **VIP**      | gpt-4o-mini   | 50 tokens    | 5,000 tokens  |
| **VVIP**     | **gpt-4o** ⭐ | 100 tokens   | 10,000 tokens |

> **VVIP 專屬優勢**: 使用更高級的 GPT-4o 模型，對話品質明顯提升
>
> **防止斷句機制**: 系統會指示 AI 確保回覆是完整句子，優先縮短內容而非中斷句子

---

## 六、角色解鎖票（永久解鎖特定角色的無限對話）

### 開通時贈送數量

| 用戶類型     | 贈送數量 | 用途                         |
| ------------ | -------- | ---------------------------- |
| **免費用戶** | 0 張     | -                            |
| **VIP**      | 10 張    | 永久解鎖與特定角色的無限對話 |
| **VVIP**     | 30 張    | 永久解鎖與特定角色的無限對話 |

### 角色解鎖票的作用

使用角色解鎖票後，該角色將**不再受到對話次數限制**，可以無限對話：

- **未使用解鎖票的角色**：

  - 免費用戶：10 次/角色（可看廣告 +5 次）
  - VIP：20 次/角色（可看廣告 +10 次）
  - VVIP：50 次/角色（可看廣告 +20 次）

- **已使用解鎖票的角色**：
  - 所有會員等級：**無限對話**（不需要看廣告）

### 購買價格（金幣）

- **基礎價格**: 300 金幣/張
- **效果**: 永久解鎖與特定角色的無限對話

---

## 七、AI 影片功能

### 開通時贈送影片卡

| 用戶類型     | 贈送數量 |
| ------------ | -------- |
| **免費用戶** | 0 張     |
| **VIP**      | 3 張     |
| **VVIP**     | 10 張    |

### 影片功能價格（金幣）

- **所有會員等級統一價格**: 200 金幣/支

---

## 八、金幣系統

### 開通時贈送金幣

| 用戶類型     | 贈送金幣 |
| ------------ | -------- |
| **免費用戶** | 0        |
| **VIP**      | 600      |
| **VVIP**     | 2000     |

### 金幣購買折扣

| 用戶類型     | 折扣 |
| ------------ | ---- |
| **免費用戶** | 原價 |
| **VIP**      | 9 折 |
| **VVIP**     | 8 折 |

### 金幣充值方案

| 方案   | 金幣數量 | 贈送 | 總計  | 價格（TWD） |
| ------ | -------- | ---- | ----- | ----------- |
| 小包   | 100      | 0    | 100   | 50          |
| 中包   | 500      | 50   | 550   | 200         |
| 大包   | 1,000    | 150  | 1,150 | 350         |
| 超大包 | 3,000    | 500  | 3,500 | 1,000       |

---

## 九、配對與搜尋功能

### 每日配對次數與廣告解鎖

| 用戶類型     | 基礎配對次數 | 廣告解鎖          | 每日廣告上限 |
| ------------ | ------------ | ----------------- | ------------ |
| **免費用戶** | 5 次/日      | ✅ 每次廣告 +1 次 | 10 次        |
| **VIP**      | 30 次/日     | ✅ 每次廣告 +5 次 | 10 次        |
| **VVIP**     | 無限制 (-1)  | ❌ 不需要         | -            |

### 搜尋與配對功能

| 用戶類型     | 進階搜尋 | 優先配對 | 即時配對 |
| ------------ | -------- | -------- | -------- |
| **免費用戶** | ❌       | ❌       | ❌       |
| **VIP**      | ✅       | ✅       | ❌       |
| **VVIP**     | ✅       | ✅       | ✅       |

---

## 十、API 速率限制

所有用戶等級共用以下速率限制（測試帳號可設定為跳過）:

| API 類型     | 限制       |
| ------------ | ---------- |
| AI 回覆生成  | 20 次/分鐘 |
| AI 建議生成  | 15 次/分鐘 |
| TTS 語音生成 | 30 次/分鐘 |
| 圖片生成     | 5 次/分鐘  |

---

## 十一、遊客（測試帳號）特殊配置

遊客帳號 (`test-user`) 的所有限制皆可在 `backend/src/config/limits.js` 中的 `TEST_ACCOUNT_LIMITS` 自由配置：

```javascript
export const TEST_ACCOUNT_LIMITS = {
  PHOTOS: 0, // 拍照次數
  CONVERSATIONS_PER_CHARACTER: 0, // 對話次數（每個角色）
  VOICE_PER_CHARACTER: 0, // 語音次數（每個角色）
  CHARACTER_CREATIONS: 0, // 角色創建次數（每月）
  ADS_DAILY: 0, // 廣告觀看次數（每日）
  MEMBERSHIP_TIER: "free", // 模擬會員等級
  SKIP_RATE_LIMIT: true, // 是否跳過 API 速率限制
};
```

---

## 十二、會員權益總覽表

### 快速對比表

| 功能             | 免費用戶               | VIP                     | VVIP                    |
| ---------------- | ---------------------- | ----------------------- | ----------------------- |
| **月費**         | 免費                   | 399 TWD                 | 999 TWD                 |
| **對話**         | 10 次/角色 + 廣告+5 次 | 20 次/角色 + 廣告+10 次 | 50 次/角色 + 廣告+20 次 |
| **語音**         | 10 次/角色 + 廣告解鎖  | 無限制                  | 無限制                  |
| **拍照**         | 3 張/週                | 3 張/週                 | 3 張/週                 |
| **角色創建**     | 3 個/月                | 3 個/月 + 10 張創建卡   | 3 個/月 + 30 張創建卡   |
| **AI 模型**      | gpt-4o-mini            | gpt-4o-mini             | gpt-4.1-mini ⭐         |
| **開通贈送金幣** | 0                      | 600                     | 2000                    |
| **角色解鎖票**   | 0                      | 10 張                   | 30 張                   |
| **使用解鎖票後** | -                      | 該角色無限對話          | 該角色無限對話          |
| **拍照卡**       | 0                      | 20 張                   | 60 張                   |
| **影片卡**       | 0                      | 3 張                    | 10 張                   |
| **金幣購買折扣** | 無                     | 9 折                    | 8 折                    |
| **廣告**         | 需要                   | 需要                    | 需要                    |

---

## 十三、重置週期說明

### 每日重置（凌晨 0:00）

- 廣告觀看次數

### 每週重置（每週一凌晨 0:00）

- 所有會員等級的拍照額度（3 張/週）

### 每月重置（每月 1 日凌晨 0:00）

- 角色創建額度（3 個/月）

### 終生不重置

- 測試帳號拍照額度
- 角色解鎖票（永久有效）
- 開通時贈送的各種卡片（創建角色卡、拍照卡、影片卡）

---

## 配置檔案位置

### Backend

- **測試帳號配置**: `backend/src/config/testAccounts.js`
- **功能限制配置**: `backend/src/config/limits.js`
- **會員等級配置**: `backend/src/membership/membership.config.js`
- **會員工具函數**: `backend/src/utils/membershipUtils.js`

### Frontend

- **測試帳號配置**: `frontend/src/config/testAccounts.js`

---

## 相關服務模組

- **對話限制追蹤**: `backend/src/conversation/conversationLimit.service.js`
- **語音限制追蹤**: `backend/src/ai/voiceLimit.service.js`
- **拍照限制追蹤**: `backend/src/ai/photoLimit.service.js`
- **角色創建限制追蹤**: `backend/src/characterCreation/characterCreationLimit.service.js`
- **廣告追蹤**: `backend/src/ad/ad.service.js`（如已實現）

---

_最後更新時間: 2025-10-31_
