# åƒ¹æ ¼ä¸ä¸€è‡´å•é¡Œä¿®æ­£ç¸½çµ

**æ—¥æœŸ**: 2025-01-20
**å•é¡Œ**: å‰ç«¯å•†åŸé¡¯ç¤ºåƒ¹æ ¼èˆ‡å¾Œç«¯å¯¦éš›æ‰£æ¬¾åƒ¹æ ¼ä¸ä¸€è‡´
**æ–¹æ¡ˆ**: çµ±ä¸€ä½¿ç”¨ `asset_packages` é›†åˆä½œç‚ºå”¯ä¸€æ•¸æ“šä¾†æº

---

## ğŸ”´ å•é¡Œæè¿°

ç”¨æˆ¶åé¥‹è³¼è²·ã€Œè§’è‰²è§£é–ç¥¨ 1 å¼µã€æ™‚ï¼š
- **å‰ç«¯é¡¯ç¤º**: 400 é‡‘å¹£
- **å¯¦éš›æ‰£æ¬¾**: 300 é‡‘å¹£

ç¶“æª¢æŸ¥ç™¼ç¾ç³»çµ±å­˜åœ¨å…©å€‹å•†å“æ•¸æ“šé›†åˆï¼š
1. **unlock_cards** - å‰ç«¯å•†åŸé¡¯ç¤ºç”¨ï¼ˆèˆŠï¼‰
2. **asset_packages** - å¾Œç«¯è³¼è²·é‚è¼¯ç”¨ï¼ˆæ–°ï¼‰

é€™å…©å€‹é›†åˆçš„åƒ¹æ ¼æ•¸æ“šä¸åŒæ­¥ï¼Œå°è‡´å‰å¾Œç«¯åƒ¹æ ¼ä¸ä¸€è‡´ã€‚

---

## ğŸ“Š å•é¡Œè¦æ¨¡

å…¨é¢æª¢æŸ¥å¾Œç™¼ç¾ **25 å€‹å•é¡Œ**ï¼š

| å•é¡Œé¡å‹ | æ•¸é‡ | èªªæ˜ |
|---------|------|------|
| åƒ¹æ ¼ä¸ä¸€è‡´ | 12 å€‹ | å…©å€‹é›†åˆä¸­åŒä¸€å•†å“åƒ¹æ ¼ä¸åŒ |
| å•†å“ç¼ºå¤± | 10 å€‹ | unlock_cards æœ‰ä½† asset_packages æ²’æœ‰ |
| ç¦®ç‰©å•†å“ | 3 å€‹ | asset_packages æœ‰ä½† unlock_cards æ²’æœ‰ï¼ˆæ­£å¸¸ï¼‰ |

---

## âœ… ä¿®æ­£æªæ–½

### 1. åƒ¹æ ¼åŒæ­¥ï¼ˆ12 å€‹å•†å“ï¼‰

| å•†å“ | èˆŠåƒ¹æ ¼ | æ–°åƒ¹æ ¼ | å·®ç•° |
|------|--------|--------|------|
| è§’è‰²è§£é–ç¥¨ 1 å¼µ | 400 | 300 | -100 â­ |
| è§’è‰²è§£é–ç¥¨ 5 å¼µ | 1,800 | 1,350 | -450 |
| è§’è‰²è§£é–ç¥¨ 10 å¼µ | 3,400 | 2,550 | -850 |
| å‰µå»ºè§’è‰²å¡ 1 å¼µ | 250 | 200 | -50 |
| å‰µå»ºè§’è‰²å¡ 5 å¼µ | 1,125 | 900 | -225 |
| å‰µå»ºè§’è‰²å¡ 10 å¼µ | 2,125 | 1,700 | -425 |
| ç…§ç‰‡è§£é–å¡ 1 å¼µ | 40 | 50 | +10 |
| ç…§ç‰‡è§£é–å¡ 10 å¼µ | 380 | 450 | +70 |
| ç…§ç‰‡è§£é–å¡ 30 å¼µ | 1,080 | 1,275 | +195 |
| èªéŸ³è§£é–å¡ 1 å¼µ | 25 | 30 | +5 |
| èªéŸ³è§£é–å¡ 20 å¼µ | 475 | 540 | +65 |
| èªéŸ³è§£é–å¡ 50 å¼µ | 1,125 | 1,275 | +150 |

### 2. è£œå……ç¼ºå¤±å•†å“ï¼ˆ10 å€‹ï¼‰

æ–°å¢åˆ° `asset_packages` é›†åˆï¼š
- è§’è‰²è§£é–ç¥¨ï¼š3 å¼µã€20 å¼µ
- å‰µå»ºè§’è‰²å¡ï¼š3 å¼µã€20 å¼µ
- ç…§ç‰‡è§£é–å¡ï¼š50 å¼µã€100 å¼µ
- å½±ç‰‡å¡ï¼š3 æ”¯ã€20 æ”¯
- èªéŸ³è§£é–å¡ï¼š100 å¼µã€200 å¼µ

### 3. å»¢æ£„ unlock_cards é›†åˆ

**å¾Œç«¯ API ä¿®æ”¹** ([assetPackages.routes.js:22-86](d:\project\chat-app-all\chat-app\backend\src\user\assetPackages.routes.js#L22-L86)):
- âœ… `/api/assets/packages` æ”¹ç‚ºå¾ `asset_packages` è®€å–
- âœ… æ–°å¢æ•¸æ“šæ ¼å¼è½‰æ›å±¤ï¼Œä¿æŒå‰ç«¯å…¼å®¹æ€§
- âœ… æ·»åŠ è¨»é‡‹èªªæ˜è®Šæ›´åŸå› å’Œæ—¥æœŸ

---

## ğŸ¯ ä¿®æ­£çµæœ

### åŸ·è¡Œè…³æœ¬
```bash
# é è¦½ä¿®æ­£è¨ˆåŠƒ
node scripts/fix-price-inconsistency.js

# åŸ·è¡Œä¿®æ­£
AUTO_EXECUTE_FIX=true node scripts/fix-price-inconsistency.js
```

### ä¿®æ­£ç¸½è¨ˆ
- âœ… æ›´æ–° unlock_cards åƒ¹æ ¼ï¼š**12 å€‹**
- âœ… æ·»åŠ åˆ° asset_packagesï¼š**10 å€‹**
- âœ… ä¿®æ”¹å¾Œç«¯ APIï¼š**1 å€‹æ–‡ä»¶**
- âœ… ç¸½å…±ä¿®æ”¹ï¼š**22 å€‹é …ç›®**

### é©—è­‰çµæœ
```bash
# é‹è¡Œæª¢æŸ¥è…³æœ¬
node scripts/check-unlock-card-prices.js

# çµæœï¼šæ‰€æœ‰è§£é–å¡åƒ¹æ ¼å·²ä¸€è‡´ âœ…
# å‰©é¤˜ 3 å€‹ã€Œå•é¡Œã€ç‚ºç¦®ç‰©å•†å“ï¼ˆgiftsï¼‰ï¼Œå±¬æ–¼æ­£å¸¸æƒ…æ³
```

---

## ğŸ“ æŠ€è¡“ç´°ç¯€

### æ•¸æ“šæµç¨‹ï¼ˆä¿®æ­£å‰ï¼‰
```
å‰ç«¯å•†åŸé¡¯ç¤º
   â†“
GET /api/assets/packages
   â†“
unlock_cards é›†åˆ (400 é‡‘å¹£) â† é¡¯ç¤ºåƒ¹æ ¼
   â†“
ç”¨æˆ¶é»æ“Šè³¼è²·
   â†“
POST /api/assets/purchase
   â†“
asset_packages é›†åˆ (300 é‡‘å¹£) â† å¯¦éš›æ‰£æ¬¾
   âŒ åƒ¹æ ¼ä¸ä¸€è‡´ï¼
```

### æ•¸æ“šæµç¨‹ï¼ˆä¿®æ­£å¾Œï¼‰
```
å‰ç«¯å•†åŸé¡¯ç¤º
   â†“
GET /api/assets/packages
   â†“
asset_packages é›†åˆ (300 é‡‘å¹£) â† çµ±ä¸€æ•¸æ“šæº
   â†“
ç”¨æˆ¶é»æ“Šè³¼è²·
   â†“
POST /api/assets/purchase
   â†“
asset_packages é›†åˆ (300 é‡‘å¹£) â† ç›¸åŒæ•¸æ“šæº
   âœ… åƒ¹æ ¼ä¸€è‡´ï¼
```

### é—œéµä»£ç¢¼è®Šæ›´

**å¾Œç«¯ API** ([assetPackages.routes.js](d:\project\chat-app-all\chat-app\backend\src\user\assetPackages.routes.js#L27-L30)):
```javascript
// ä¿®æ­£å‰
const snapshot = await db
  .collection("unlock_cards")  // âŒ èˆŠé›†åˆ
  .where("status", "==", "active")
  .get();

// ä¿®æ­£å¾Œ
const snapshot = await db
  .collection("asset_packages")  // âœ… æ–°é›†åˆ
  .where("status", "==", "active")
  .get();
```

---

## ğŸ” ç›¸é—œæ–‡ä»¶

### ä¿®æ­£è…³æœ¬
- [check-unlock-card-prices.js](d:\project\chat-app-all\chat-app\backend\scripts\check-unlock-card-prices.js) - åƒ¹æ ¼æª¢æŸ¥è¨ºæ–·è…³æœ¬
- [fix-price-inconsistency.js](d:\project\chat-app-all\chat-app\backend\scripts\fix-price-inconsistency.js) - åƒ¹æ ¼ä¿®æ­£åŸ·è¡Œè…³æœ¬

### å¾Œç«¯ä»£ç¢¼
- [assetPackages.routes.js](d:\project\chat-app-all\chat-app\backend\src\user\assetPackages.routes.js) - API è·¯ç”±ï¼ˆå·²ä¿®æ”¹ï¼‰
- [assetPurchase.service.js](d:\project\chat-app-all\chat-app\backend\src\user\assetPurchase.service.js) - è³¼è²·æœå‹™ï¼ˆä½¿ç”¨ asset_packagesï¼‰

### å‰ç«¯ä»£ç¢¼ï¼ˆç„¡éœ€ä¿®æ”¹ï¼‰
- [ShopView.vue](d:\project\chat-app-all\chat-app\frontend\src\views\ShopView.vue) - å•†åŸé é¢
- [useShopItems.ts](d:\project\chat-app-all\chat-app\frontend\src\composables\shop\useShopItems.ts) - å•†å“åˆ—è¡¨è™•ç†

---

## âœ… é©—è­‰æ¸…å–®

- [x] æª¢æŸ¥è…³æœ¬é©—è­‰æ‰€æœ‰åƒ¹æ ¼å·²ä¸€è‡´
- [x] unlock_cards é›†åˆåƒ¹æ ¼å·²æ›´æ–°
- [x] asset_packages é›†åˆå·²è£œå……ç¼ºå¤±å•†å“
- [x] å¾Œç«¯ API å·²æ”¹ç‚ºè®€å– asset_packages
- [x] å‰ç«¯ç„¡éœ€ä¿®æ”¹ï¼ˆAPI æ ¼å¼ä¿æŒå…¼å®¹ï¼‰

---

## ğŸš€ å¾ŒçºŒå»ºè­°

### ç«‹å³åŸ·è¡Œ
1. âœ… é‡å•Ÿå¾Œç«¯æœå‹™ï¼Œä½¿ API ä¿®æ”¹ç”Ÿæ•ˆ
2. âœ… æ¸…ç†å‰ç«¯ç·©å­˜
3. âœ… æ¸¬è©¦è³¼è²·æµç¨‹ï¼Œç¢ºèªåƒ¹æ ¼é¡¯ç¤ºèˆ‡æ‰£æ¬¾ä¸€è‡´

### é•·æœŸç¶­è­·
1. **å»¢æ£„ unlock_cards é›†åˆ**
   - å¯ä»¥å°‡ unlock_cards é›†åˆé‡å‘½åç‚º `unlock_cards_deprecated`
   - æˆ–åœ¨ç®¡ç†å¾Œå°æ·»åŠ è­¦å‘Šï¼Œä¸å†ä½¿ç”¨æ­¤é›†åˆ

2. **çµ±ä¸€æ•¸æ“šç®¡ç†**
   - æ‰€æœ‰å•†å“æ•¸æ“šçµ±ä¸€åœ¨ `asset_packages` ç®¡ç†
   - å¦‚éœ€æ·»åŠ æ–°å•†å“ï¼Œåªåœ¨ `asset_packages` æ·»åŠ 

3. **æ–‡æª”æ›´æ–°**
   - æ›´æ–° [firestore-collections.md](d:\project\chat-app-all\chat-app\docs\firestore-collections.md)
   - æ¨™è¨˜ unlock_cards ç‚ºå·²å»¢æ£„

---

## ğŸ“Œ å‚™è¨»

- ä¿®æ­£å¾Œæ‰€æœ‰åƒ¹æ ¼ä»¥ `asset_packages` ç‚ºæº–
- `unlock_cards` é›†åˆå·²ä¸å†è¢«å¾Œç«¯ä½¿ç”¨ï¼ˆå¯å®‰å…¨åˆªé™¤ï¼‰
- å‰ç«¯ API èª¿ç”¨ä¿æŒä¸è®Šï¼Œå‘å¾Œå…¼å®¹
- ç¦®ç‰©å•†å“ï¼ˆgiftsï¼‰æœ¬ä¾†å°±åªåœ¨ `asset_packages` ä¸­ï¼Œç„¡éœ€åœ¨ `unlock_cards` ä¸­æ·»åŠ 

---

**ä¿®æ­£å®Œæˆæ™‚é–“**: 2025-01-20
**ä¿®æ­£äººå“¡**: Claude Code
**ç‹€æ…‹**: âœ… å·²å®Œæˆä¸¦é©—è­‰
