# ChatListView 重構測試檢查清單

## 📋 重構成果

- **原始行數**: 1,701 行
- **重構後行數**: 656 行
- **減少**: 1,045 行（**61.5% 減少**）
- **狀態**: ✅ 編譯成功，無錯誤

## 🎯 測試訪問

開發服務器已啟動：
- **前端**: http://localhost:5173/
- **後端**: http://localhost:4000/

## ✅ 功能測試檢查清單

### 1. 基本顯示（ChatListView.vue + ChatListHeader.vue + ChatListEmpty.vue）
- [ ] 頁面正常載入，顯示「訊息」標題
- [ ] 顯示兩個標籤：「全部」和「收藏」
- [ ] 如果沒有對話，顯示空狀態提示訊息
- [ ] 載入中顯示旋轉載入圖示

### 2. 標籤切換（ChatListHeader.vue + useChatListState.js）
- [ ] 點擊「全部」標籤，顯示所有對話
- [ ] 點擊「收藏」標籤，只顯示已收藏的對話
- [ ] 切換標籤時，活動標籤有視覺反饋（下劃線）
- [ ] 切換標籤時，已打開的滑動操作自動關閉
- [ ] 切換標籤時，刪除確認對話框自動關閉（如果打開）

### 3. 對話列表顯示（ChatListItem.vue）
- [ ] 每個對話項顯示角色頭像
- [ ] 每個對話項顯示角色名稱（displayName）
- [ ] 每個對話項顯示最後訊息預覽（截斷超過 15 字元）
- [ ] 每個對話項顯示時間標籤（timeLabel）
- [ ] 頭像正確載入和顯示

### 4. 滑動手勢操作（ChatListItem.vue + ChatListView.vue）
- [ ] **向左滑動**對話項，顯示操作按鈕（收藏/刪除）
- [ ] 滑動超過閾值（48px）後，鬆手時按鈕保持顯示
- [ ] 滑動未超過閾值，鬆手時按鈕自動隱藏
- [ ] **向右滑動**有輕微彈性效果（最多 22px）
- [ ] 打開一個對話的滑動操作時，其他對話的滑動操作自動關閉
- [ ] 滑動操作過程中，點擊對話不會觸發導航
- [ ] 滑動手勢流暢，無卡頓

### 5. 收藏功能（ChatListItem.vue + ChatListView.vue）
- [ ] 點擊收藏按鈕（愛心圖標），切換收藏狀態
- [ ] 未收藏時顯示空心愛心，收藏後顯示實心愛心
- [ ] 收藏操作時，按鈕顯示 loading 狀態（禁用）
- [ ] 收藏成功後，顯示成功提示「已加入收藏對話」
- [ ] 取消收藏成功後，顯示提示「已取消收藏對話」
- [ ] 收藏操作失敗時，顯示錯誤訊息並回滾狀態
- [ ] 在「收藏」標籤頁中，收藏的對話顯示實心愛心
- [ ] 樂觀更新：點擊收藏按鈕後立即更新 UI，無需等待服務器回應

### 6. 隱藏（刪除）對話功能（DeleteConfirmDialog.vue + ChatListView.vue）
- [ ] 滑動對話後，點擊刪除按鈕（垃圾桶圖標）
- [ ] 顯示確認對話框，包含角色名稱
- [ ] 確認對話框顯示提示：「對話紀錄會保留，隨時都能重新開啟」
- [ ] 點擊「取消」按鈕，關閉對話框，不隱藏對話
- [ ] 點擊「確定隱藏」按鈕，隱藏對話
- [ ] 隱藏成功後，顯示提示「已隱藏對話，紀錄會保留」
- [ ] 隱藏的對話從列表中消失
- [ ] 對話框有淡入/滑入動畫效果
- [ ] 點擊對話框背景遮罩，關閉對話框

### 7. 隱藏對話持久化（ChatListView.vue）
- [ ] 隱藏對話後，重新載入頁面，對話仍然隱藏
- [ ] 切換標籤後返回，隱藏的對話仍然隱藏
- [ ] 隱藏的對話存儲在 localStorage 中（key: `chat-list-hidden-threads:<userId>`）

### 8. 隱藏對話自動恢復（ChatListView.vue）
- [ ] 隱藏對話後，如果角色發送新訊息
- [ ] 對話自動從隱藏列表中恢復並顯示
- [ ] 恢復的對話顯示新訊息內容

### 9. 無限滾動分頁（ChatListView.vue + usePaginatedConversations.js）
- [ ] 初始載入顯示前 20 個對話
- [ ] 滾動到列表底部（距離底部 200px）
- [ ] 自動載入更多對話（顯示「載入更多對話...」）
- [ ] 載入更多對話後，列表增加新的對話項
- [ ] 沒有更多對話時，不再觸發載入
- [ ] 在「收藏」標籤頁，不觸發無限滾動（收藏列表一次性載入）

### 10. 操作提示訊息（ChatListBanner.vue）
- [ ] 收藏/取消收藏操作後，頂部顯示提示橫幅
- [ ] 隱藏對話後，顯示提示橫幅
- [ ] 操作失敗時，顯示錯誤提示（紅色背景）
- [ ] 提示訊息自動在 800ms 後消失
- [ ] 提示橫幅有淡入/淡出動畫效果

### 11. 對話導航（ChatListView.vue）
- [ ] 點擊對話項（非滑動狀態），導航到聊天頁面
- [ ] 導航後，URL 變為 `/chat/:id`
- [ ] 滑動操作打開時點擊對話，不觸發導航
- [ ] 導航後，ChatView 正確載入對應角色的對話

### 12. 響應式設計
- [ ] **手機視圖**（< 768px）：對話列表佔滿螢幕寬度
- [ ] **平板視圖**（768px - 1024px）：對話列表居中，適當間距
- [ ] **桌面視圖**（> 1024px）：對話列表居中，最大寬度限制
- [ ] 滑動手勢在觸控螢幕上流暢
- [ ] 頭像、文字大小在不同裝置上合適

### 13. 無障礙支持（Accessibility）
- [ ] 標籤頁按鈕有 `role="tab"` 和 `aria-selected` 屬性
- [ ] 收藏按鈕有 `aria-label="收藏對話"` 和 `aria-pressed` 屬性
- [ ] 刪除按鈕有 `aria-label="隱藏對話"` 屬性
- [ ] 確認對話框有 `role="dialog"` 和 `aria-modal="true"` 屬性
- [ ] 空狀態有 `aria-live="polite"` 屬性
- [ ] 使用鍵盤可以導航和操作所有功能

### 14. 邊界情況測試
- [ ] **沒有對話**：顯示空狀態提示
- [ ] **只有一個對話**：正常顯示，不觸發分頁載入
- [ ] **所有對話都是收藏**：「收藏」標籤頁顯示全部對話
- [ ] **沒有收藏對話**：「收藏」標籤頁顯示空狀態
- [ ] **所有對話都被隱藏**：「全部」標籤頁顯示空狀態
- [ ] **未登入用戶**：收藏操作顯示「請登入後才能收藏角色」
- [ ] **網路錯誤**：操作失敗時顯示錯誤訊息並回滾狀態

### 15. 性能測試
- [ ] 大量對話（100+ 個）時，列表渲染流暢
- [ ] 滑動操作無延遲，動畫流暢（60fps）
- [ ] 切換標籤快速，無卡頓
- [ ] 分頁載入不阻塞 UI
- [ ] 沒有內存洩漏（長時間使用後性能穩定）

## 🐛 已知問題記錄

測試過程中發現的問題請記錄在此：

---

## ✨ 重構改進總結

### 代碼組織
- ✅ 拆分為 5 個子組件，職責清晰
- ✅ 狀態邏輯提取到 `useChatListState.js` composable
- ✅ 模板代碼從 ~700 行減少到 ~70 行

### 可維護性
- ✅ 每個組件行數 < 500 行（最大 430 行）
- ✅ 清晰的註釋區分功能區塊
- ✅ 易於單元測試

### 可復用性
- ✅ 子組件可在其他頁面復用
- ✅ useChatListState 可用於其他對話列表場景

### 性能
- ✅ 減少不必要的重渲染
- ✅ 優化的計算屬性依賴
- ✅ 更快的 HMR（熱模組替換）

## 📊 測試結論

**測試日期**: _______________

**測試人員**: _______________

**整體評價**:
- [ ] ✅ 所有功能正常，可以上線
- [ ] ⚠️ 部分功能有小問題，需要修復
- [ ] ❌ 發現嚴重問題，需要重新檢查

**備註**:
_______________________________________________
_______________________________________________
_______________________________________________
